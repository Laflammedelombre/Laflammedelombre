<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PMTZHZKR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Flamme de l'Ombre - Formulaire</title>
    <style>
        /* Styles CSS */
        body { background-color: black; color: white; font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; }
        header { padding: 20px; }
        h1 { font-size: 3em; margin: 0.2em 0; }
        p { font-size: 1.5em; margin-top: 10px; }
        nav ul { list-style-type: none; padding: 0; margin: 20px 0; display: flex; flex-wrap: wrap; justify-content: center; }
        nav ul li { margin: 10px 15px; }
        nav ul li a { color: white; text-decoration: none; font-weight: bold; padding: 5px 10px; border-radius: 4px; }
        nav ul li a:hover { text-decoration: underline; }
        
        .suivi-button-container { text-align: center; margin: 30px auto; max-width: 600px; }
        .suivi-button {
            display: inline-block;
            background-color: #8B0000; 
            color: white !important;
            padding: 12px 25px;
            border-radius: 6px;
            text-decoration: none !important;
            font-weight: bold;
            font-size: 1.1em;
            letter-spacing: 1px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: none;
            cursor: pointer;
        }
        .suivi-button:hover { background-color: #A52A2A !important; transform: translateY(-2px); }

        .page-image { width: 80%; max-width: 600px; margin: 20px auto 40px auto; display: block; border-radius: 8px; }
        .form-container { max-width: 700px; margin: 40px auto; background: #111; padding: 20px 30px; border-radius: 10px; text-align: left; }
        .form-container h2 { text-align: center; color: #fff; margin-bottom: 25px; }
        .info-box { background: #222; border-left: 4px solid #007bff; padding: 10px; margin-bottom: 15px; border-radius: 6px; color: #fff; font-size: 1em; text-align: center; }
        .disclaimer-message { background-color: #202010; border-left: 5px solid #ffcc00; padding: 15px; margin-bottom: 30px; border-radius: 6px; color: #ccc; font-size: 1em; line-height: 1.5; }
        
        /* BANDEAU ANONYME */
        .anonymous-box {
            background: #1a0000;
            border: 2px dashed #8B0000;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
        }
        .anonymous-box h3 { color: #ff4444; margin-top: 0; font-size: 1.1em; }
        .anonymous-box p { font-size: 0.8em; color: #bbb; line-height: 1.4; margin: 10px 0; }
        .toggle-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            background: #333;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
            transition: background 0.3s;
        }
        .toggle-container:hover { background: #444; }
        .toggle-container input { width: auto !important; margin-right: 12px !important; margin-top: 0 !important; cursor: pointer; }

        .form-container label { display: block; margin-top: 15px; font-weight: bold; }
        .facultatif { font-size: 0.8em; font-weight: normal; color: #aaa; margin-left: 4px; }

        .form-container input, .form-container textarea, .form-container select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #555; background: #222; color: #fff; box-sizing: border-box; transition: border 0.3s ease; }
        .form-container .input-error { border: 1px solid #ff6666 !important; }
        .date-input-group { display: flex; align-items: center; gap: 15px; }
        .date-input-group input[type="date"] { flex-grow: 1; width: auto; }
        .age-display { font-weight: normal; font-size: 0.9em; color: #aaa; white-space: nowrap; }
        .form-container button[type="submit"] { margin-top: 25px; padding: 12px 18px; border: none; border-radius: 66px; background: #007bff; color: white; cursor: pointer; width: 100%; font-weight: bold; letter-spacing: 1px; transition: background 0.3s; }
        .form-container button[type="submit"]:hover { background: #0056b3; }
        
        .status-message { margin-top: 12px; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
        .success { background: #3c5244; border: 1px solid #7ad6a7; color: #d4edda; }
        .error { background: #5c3434; border: 1px solid #f1a0a0; color: #f8d7da; }
        .sending { background: #2a3e5c; border: 1px solid #5c7fbf; color: #c9e6ff; }
        
        .support-section { text-align: center; margin-top: 40px; padding: 15px; background-color: #151515; border-top: 1px solid #333; color: #aaa; font-size: 0.85em; border-radius: 0 0 10px 10px; margin: 40px -30px -30px -30px; }
        .highlight { font-weight: bold; color: white; }
        .paypal-button { display: inline-block; padding: 8px 18px; background-color: #0070ba; color: white; text-decoration: none; border-radius: 20px; font-weight: bold; font-size: 0.9em; transition: background-color 0.3s ease, transform 0.2s ease; box-shadow: 0 0 5px rgba(0,0,0,0.5); border: none; cursor: pointer; }
        @media (max-width: 768px) { .form-container { margin: 20px; padding: 20px; } }
    </style>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMTZHZKR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header>
    <h1>La Flamme de l'Ombre</h1>
    <p>Cartomancien, cr√©ateur</p>
</header>

<nav>
    <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="about.html">√Ä propos</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="avis.html">Avis</a></li>
        <li><a href="carte.html">Carte du jour</a></li>
    </ul>
</nav>

<img src="images/Tirage.webp" alt="Tirage de Cartes" class="page-image">

<div class="suivi-button-container">
    <a href="Suivi.html" class="suivi-button">V√©rifier le Statut de ma Demande</a>
</div>

<div class="form-container">
    <h2>Pose ta question (Gratuite)</h2>
    
    <div class="anonymous-box">
        <h3>ü§´ Mode Anonyme disponible</h3>
        <p>
            Vous souhaitez rester discret ? C'est possible !<br>
            1. Activez le bouton ci-dessous.<br>
            2. Utilisez un <strong>Pseudo</strong> √† la place de votre pr√©nom.<br>
            3. <strong>IMPORTANT :</strong> Pr√©cisez dans votre question comment vous contacter (TikTok, Instagram, etc.) car vous ne recevrez pas d'e-mail.
        </p>
        <label class="toggle-container">
            <input type="checkbox" id="anonymousToggle"> 
            <span>ACTIVER LE MODE ANONYME</span>
        </label>
    </div>

    <div class="disclaimer-message">
        **‚ú® Conseil de lecture :** Ces consultations vous sont offertes. Pour que chaque lecture garde son sens, utilisez-les avec intention.
    </div>
    
    <form id="questionForm" method="POST">
        
        <label for="nom">Nom <span class="facultatif">(facultatif)</span></label>
        <input type="text" id="nom" name="Nom">

        <label for="prenom">Pr√©nom ou Pseudo *</label>
        <input type="text" id="prenom" name="Pr√©nom" required aria-required="true">

        <label for="date_naissance">Date de naissance *</label>
        <div class="date-input-group">
            <input type="date" id="date_naissance" name="Date_Naissance" required aria-required="true" onchange="calculateAge('date_naissance', 'age_display', 'age_client')">
            <span id="age_display" class="age-display">√Çge : --</span>
        </div>
        <input type="hidden" id="age_client" name="Age"> 
        
        <label for="email">Adresse email *</label>
        <input type="email" id="email" name="Email" placeholder="exemple@domaine.com" required aria-required="true">

        <label for="nom_tiers">Nom personne tierce <span class="facultatif">(facultatif)</span></label>
        <input type="text" id="nom_tiers" name="Nom_Partenaire">

        <label for="prenom_tiers">Pr√©nom personne tierce</label>
        <input type="text" id="prenom_tiers" name="Pr√©nom_Partenaire">

        <label for="date_naissance_tiers">Date de naissance personne tierce</label>
        <div class="date-input-group">
            <input type="date" id="date_naissance_tiers" name="Date_Naissance_Partenaire" onchange="calculateAge('date_naissance_tiers', 'age_display_tiers', 'age_tiers')">
            <span id="age_display_tiers" class="age-display">√Çge : --</span>
        </div>
        <input type="hidden" id="age_tiers" name="Age_Partenaire">

        <label for="question">Question pr√©cise *</label>
        <textarea id="question" name="Question" required aria-required="true" placeholder="Si anonyme, indiquez ici votre TikTok/Insta pour la r√©ponse..."></textarea>

        <label for="temporalite">Temporalit√© *</label>
        <select id="temporalite" name="Temporalit√©" required aria-required="true">
            <option value="">-- Choisissez --</option>
            <option value="3 mois">Dans les 3 mois</option>
            <option value="1 an">Dans l'ann√©e</option>
            <option value="ann√©e en cours">Dans l‚Äôann√©e en cours</option>
            <option value="2 ans">Dans les 2 ans</option>
            <option value="3 ans">Dans les 3 ans</option>
            <option value="non concern√©">Non concern√© par la temporalit√©</option>
        </select>

        <button type="submit">Envoyer la question</button>
    </form>
    <div id="status"></div>

    <div class="support-section">
        <p>Ce service vous est utile ? <span class="highlight">Faire un Tips</span> (montant libre).</p>
        <a href="https://www.paypal.com/ncp/payment/LQX3W8VBMFQTQ" target="_blank" class="paypal-button">Faire un Tips</a>
    </div>
</div>

<script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwZWo6QHG4g3HrI5aFqabLlupVp0TZuEhB9w9oZTQfZ75bDuAfAsl-TdltFQDd2Bkwj0Q/exec'; 

    const form = document.getElementById('questionForm');
    const statusDiv = document.getElementById('status');
    const anonToggle = document.getElementById('anonymousToggle');
    const emailInput = document.getElementById('email');

    // LOGIQUE MODE ANONYME
    anonToggle.addEventListener('change', function() {
        if (this.checked) {
            emailInput.value = "laflammedelombre@gmail.com";
            emailInput.readOnly = true;
            emailInput.style.backgroundColor = "#333";
            emailInput.style.color = "#888";
        } else {
            emailInput.value = "";
            emailInput.readOnly = false;
            emailInput.style.backgroundColor = "#222";
            emailInput.style.color = "#fff";
        }
    });

    function calculateAge(dateInputId, ageDisplayId, ageHiddenId) {
        const dateInput = document.getElementById(dateInputId);
        const ageDisplay = document.getElementById(ageDisplayId);
        const ageHidden = document.getElementById(ageHiddenId);
        if (!dateInput.value) return;
        const today = new Date();
        const birthDate = new Date(dateInput.value);
        let age = today.getFullYear() - birthDate.getFullYear();
        if (today.getMonth() < birthDate.getMonth() || (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())) age--;
        ageDisplay.textContent = `√Çge : ${age} ans`;
        ageHidden.value = age; 
    }

    function validateForm() {
        let isValid = true;
        const requiredFields = form.querySelectorAll('[required]');
        requiredFields.forEach(field => field.classList.remove('input-error'));
        requiredFields.forEach(field => {
            if (!field.value.trim()) { field.classList.add('input-error'); isValid = false; }
        });
        return isValid;
    }

    form.addEventListener('submit', function(event) {
        event.preventDefault(); 
        if (!validateForm()) {
            statusDiv.innerHTML = '<div class="status-message error">‚ùå Champs obligatoires manquants.</div>';
            return;
        }
        
        const submitButton = form.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        statusDiv.innerHTML = '<div class="status-message sending">‚öôÔ∏è Envoi en cours...</div>';
        
        fetch(APPS_SCRIPT_URL, { method: 'POST', body: new FormData(form) })
        .then(res => res.json())
        .then(data => {
            if (data.result === 'success') {
                statusDiv.innerHTML = `<div class="status-message success">‚úÖ Envoy√© ! ID de suivi : <strong>${data.id}</strong></div>`;
                form.reset();
                if(anonToggle.checked) anonToggle.click(); // Reset le mode anonyme
            } else {
                statusDiv.innerHTML = `<div class="status-message error">‚ùå Erreur : ${data.message}</div>`;
            }
        })
        .catch(() => { statusDiv.innerHTML = '<div class="status-message error">‚ùå Erreur de connexion.</div>'; })
        .finally(() => { submitButton.disabled = false; });
    });
</script>
</body>
</html>
