<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PMTZHZKR');</script>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Flamme de l'Ombre - Formulaire</title>
    <style>
        /* Base Styling (Fond noir) */
        body {
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        header { padding: 20px; }
        h1 { font-size: 3em; margin: 0.2em 0; }
        p { font-size: 1.5em; margin-top: 10px; }
        
        /* Navigation */
        nav ul {
            list-style-type: none; padding: 0; margin: 20px 0;
            display: flex; flex-wrap: wrap; justify-content: center;
        }
        nav ul li { margin: 10px 15px; }
        nav ul li a { color: white; text-decoration: none; font-weight: bold; }
        nav ul li a:hover { text-decoration: underline; }

        /* Image */
        .page-image {
            width: 80%; /* Ajuste la taille de l'image */
            max-width: 600px;
            margin: 20px auto 40px auto; /* Marge supérieure et inférieure */
            display: block;
            border-radius: 8px; /* Ajout d'un léger arrondi pour l'esthétique */
        }

        /* Formulaire */
        .form-container {
            max-width: 700px;
            margin: 40px auto;
            background: #111;
            padding: 20px 30px; 
            border-radius: 10px;
            text-align: left;
        }
        .form-container h2 {
            text-align: center;
            color: #fff;
            margin-bottom: 25px; 
        }
        
        /* Message d'info standard (pour la personne tierce) */
        .info-box {
            background: #222;
            border-left: 4px solid #007bff;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 6px;
            color: #fff;
            font-size: 1em;
            text-align: center; 
        }
        
        /* Styles pour le message de sensibilisation */
        .disclaimer-message {
            background-color: #202010; 
            border-left: 5px solid #ffcc00; 
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 6px;
            color: #ccc;
            font-size: 1em;
            line-height: 1.5;
        }
        .disclaimer-message strong {
            color: white;
        }

        .form-container label {
            display: block;
            margin-top: 15px; 
            font-weight: bold;
        }
        /* Styles pour tous les champs d'entrée */
        .form-container input, .form-container textarea, .form-container select {
            width: 100%; padding: 10px; margin-top: 5px;
            border-radius: 6px; border: 1px solid #555;
            background: #222; color: #fff; box-sizing: border-box;
            transition: border 0.3s ease;
        }
        /* Style pour champ en erreur (validé par JS) */
        .form-container .input-error {
            border: 1px solid #ff6666 !important; /* Bordure rouge */
        }
        /* Style spécifique pour le conteneur de date de naissance pour alignement */
        .date-input-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .date-input-group input[type="date"] {
            flex-grow: 1;
            width: auto; /* Annule le width: 100% ci-dessus */
        }
        .age-display {
            font-weight: normal;
            font-size: 0.9em;
            color: #aaa;
            white-space: nowrap;
        }


        .form-container button[type="submit"] { 
            margin-top: 25px;
            padding: 12px 18px;
            border: none; border-radius: 66px; 
            background: #007bff; color: white; cursor: pointer;
            width: 100%;
            font-weight: bold;
            letter-spacing: 1px;
            transition: background 0.3s;
        }
        .form-container button[type="submit"]:hover { background: #0056b3; }
        
        /* Messages de validation (Affichés via JS) */
        .status-message {
            margin-top: 12px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: bold;
        }
        .success { 
            background: #3c5244; 
            border: 1px solid #7ad6a7; 
            color: #d4edda; 
        }
        .error { 
            background: #5c3434; 
            border: 1px solid #f1a0a0; 
            color: #f8d7da; 
        }

        /* Styles du bouton de Tips (Soutien) - Discret */
        .support-section {
            text-align: center;
            margin-top: 40px;
            padding: 15px;
            background-color: #151515; 
            border-top: 1px solid #333; 
            color: #aaa; 
            font-size: 0.85em; 
            border-radius: 0 0 10px 10px; 
            margin: 40px -30px -30px -30px; 
        }

        .support-text {
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .asterisk {
            vertical-align: super;
            font-size: 0.7em;
            margin-right: 2px;
        }

        .highlight {
            font-weight: bold;
            color: white; 
        }

        .paypal-button {
            display: inline-block;
            padding: 8px 18px;
            background-color: #0070ba; 
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 0 5px rgba(0,0,0,0.5); 
            border: none;
            cursor: pointer;
        }

        .paypal-button:hover {
            background-color: #005ea6;
            transform: translateY(-1px);
        }
        
        /* Media queries */
        @media (max-width: 768px) {
            .form-container { margin: 20px; padding: 20px; }
            h1 { font-size: 2.5em; }
            p { font-size: 1.2em; }
        }
        @media (max-width: 480px) {
            h1 { font-size: 2em; }
            p { font-size: 1em; }
            nav ul li { margin: 10px 5px; }
            .date-input-group {
                flex-direction: column;
                gap: 5px;
            }
            .age-display {
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMTZHZKR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<header>
    <h1>La Flamme de l'Ombre</h1>
    <p>Cartomancien, créateur</p>
</header>

<nav>
    <ul>
        <li><a href="about.html">À propos</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="avis.html">Avis</a></li>
        <li><a href="carte.html">Carte du jour</a></li>
    </ul>
</nav>

<img src="images/Tirage.webp" alt="Tirage de Cartes" class="page-image">

<div class="form-container">
    <h2>Pose ta question (Gratuite)</h2>
    
    <div class="disclaimer-message">
        **✨ Conseil de lecture :** Ces consultations vous sont offertes. Cependant, il est essentiel de se rappeler que la **précision des cartes** et la **clarté du message** peuvent s'estomper si l'on en abuse. Pour que chaque lecture garde tout son sens et sa puissance, nous vous encourageons à l'utiliser avec intention et non par habitude.
    </div>
    
    <div class="info-box">
        Remplissez les champs concernant une personne tierce <strong>seulement si votre question concerne une autre personne</strong>.
    </div>
    
    <form id="questionForm" action="https://formspree.io/f/movkbvlr" method="POST">
        
        <label for="nom">Nom *</label>
        <input type="text" id="nom" name="nom" required>

        <label for="prenom">Prénom *</label>
        <input type="text" id="prenom" name="prenom" required>

        <label for="date_naissance">Date de naissance *</label>
        <div class="date-input-group">
            <input type="date" id="date_naissance" name="date_naissance" required onchange="calculateAge('date_naissance', 'age_display', 'age_hidden')">
            <span id="age_display" class="age-display">Âge : --</span>
        </div>
        <input type="hidden" id="age_hidden" name="age_client">
        
        <label for="email">Adresse email *</label>
        <input type="email" id="email" name="email" placeholder="exemple@domaine.com" required>

        <label for="nom_tiers">Nom personne tierce</label>
        <input type="text" id="nom_tiers" name="nom_tiers" placeholder="Uniquement si question concerne une autre personne">

        <label for="prenom_tiers">Prénom personne tierce</label>
        <input type="text" id="prenom_tiers" name="prenom_tiers" placeholder="Uniquement si question concerne une autre personne">

        <label for="date_naissance_tiers">Date de naissance personne tierce</label>
        <div class="date-input-group">
            <input type="date" id="date_naissance_tiers" name="date_naissance_tiers" onchange="calculateAge('date_naissance_tiers', 'age_display_tiers', 'age_hidden_tiers')">
            <span id="age_display_tiers" class="age-display">Âge : --</span>
        </div>
        <input type="hidden" id="age_hidden_tiers" name="age_tiers">


        <label for="question">Question précise *</label>
        <textarea id="question" name="question" required></textarea>

        <label for="temporalite">Temporalité *</label>
        <select id="temporalite" name="temporalite" required>
            <option value="">-- Choisissez --</option>
            <option value="3 mois">Dans les 3 mois</option>
            <option value="1 an">Dans l'année</option>
            <option value="année en cours">Dans l’année en cours</option>
            <option value="2 ans">Dans les 2 ans</option>
            <option value="3 ans">Dans les 3 ans</option>
            <option value="non concerné">Non concerné par la temporalité</option>
        </select>

        <button type="submit">Envoyer la question</button>
    </form>
    <div id="status"></div>

    <div class="support-section">
        <p class="support-text">
            <span class="asterisk">*</span> Ce service vous est utile ? Si vous le souhaitez et le pouvez, vous pouvez me soutenir par un petit <span class="highlight">Tips</span> (montant libre, aucun minimum requis) via le bouton ci-dessous. Merci infiniment !
        </p>
        <a href="https://www.paypal.com/ncp/payment/LQX3W8VBMFQTQ" target="_blank" class="paypal-button">
            Faire un Tips
        </a>
    </div>
    
</div>

<script>
    const form = document.getElementById('questionForm');
    const statusDiv = document.getElementById('status');

    /**
     * Calcule l'âge à partir d'une date de naissance.
     * @param {string} dateInputId - L'ID de l'input type="date" (e.g., 'date_naissance').
     * @param {string} ageDisplayId - L'ID de l'élément <span> où afficher l'âge (e.g., 'age_display').
     * @param {string} ageHiddenId - L'ID du champ input hidden où stocker l'âge (e.g., 'age_hidden').
     */
    function calculateAge(dateInputId, ageDisplayId, ageHiddenId) {
        const dateInput = document.getElementById(dateInputId);
        const ageDisplay = document.getElementById(ageDisplayId);
        const ageHidden = document.getElementById(ageHiddenId);
        
        const birthDate = new Date(dateInput.value);
        
        if (isNaN(birthDate) || dateInput.value === "") {
            ageDisplay.textContent = 'Âge : --';
            ageHidden.value = '';
            return;
        }

        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDifference = today.getMonth() - birthDate.getMonth();

        // Ajuster si l'anniversaire n'est pas encore passé cette année
        if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }

        ageDisplay.textContent = `Âge : ${age} ans`;
        ageHidden.value = age; // Stocke l'âge dans le champ masqué pour l'envoi par email
    }

    /**
     * Valide les champs requis du formulaire.
     * @returns {boolean} - Vrai si tous les champs requis sont remplis, Faux sinon.
     */
    function validateForm() {
        let isValid = true;
        const requiredFields = form.querySelectorAll('[required]');

        // Réinitialiser les styles d'erreur
        requiredFields.forEach(field => {
            field.classList.remove('input-error');
        });
        statusDiv.innerHTML = '';

        let firstErrorField = null;

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('input-error');
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = field;
                }
            }
        });

        if (!isValid) {
            statusDiv.innerHTML = '<div class="status-message error">❌ Vérifiez les champs obligatoires (marqués en rouge).</div>';
            
            // Focus sur le premier champ en erreur
            if (firstErrorField) {
                firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstErrorField.focus();
            }
        }

        return isValid;
    }

    // Attacher la fonction de calcul de l'âge au chargement de la page et aux changements
    document.addEventListener('DOMContentLoaded', () => {
        calculateAge('date_naissance', 'age_display', 'age_hidden');
        calculateAge('date_naissance_tiers', 'age_display_tiers', 'age_hidden_tiers');
    });


    // Gestion de la soumission du formulaire
    form.addEventListener('submit', function(event) {
        event.preventDefault(); // Empêche l'envoi par défaut

        if (!validateForm()) {
            return; // Arrête la soumission si la validation échoue
        }
        
        statusDiv.innerHTML = '<div class="status-message">⏳ Envoi en cours...</div>';
        
        const formData = new FormData(form);
        const actionUrl = form.action;

        fetch(actionUrl, {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                // Affichage du pop-up de succès et du message stylisé
                alert('Demande envoyée ! La Flamme reviendra vers vous dès que possible par email.');
                statusDiv.innerHTML = '<div class="status-message success">✅ Demande envoyée ! La Flamme reviendra vers vous par email le plus vite possible.</div>';
                form.reset();
                
                // Réinitialiser l'affichage de l'âge après le reset du formulaire
                document.getElementById('age_display').textContent = 'Âge : --';
                document.getElementById('age_display_tiers').textContent = 'Âge : --';
                document.getElementById('age_hidden').value = '';
                document.getElementById('age_hidden_tiers').value = '';

            } else {
                // Affichage du pop-up d'erreur et du message stylisé
                alert("❌ Une erreur est survenue lors de l'envoi. Veuillez réessayer.");
                statusDiv.innerHTML = '<div class="status-message error">❌ Une erreur est survenue. Veuillez réessayer.</div>';
            }
        })
        .catch(() => {
            // Affichage du pop-up d'erreur et du message stylisé
            alert("❌ Une erreur de connexion est survenue. Veuillez vérifier votre réseau.");
            statusDiv.innerHTML = '<div class="status-message error">❌ Une erreur est survenue. Veuillez réessayer.</div>';
        });
    });
</script>

</body>
</html>
