<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <script>
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-PMTZHZKR');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Flamme de l'Ombre - Formulaire</title>
    <style>
        /* Styles CSS */
        body { background-color: black; color: white; font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; }
        header { padding: 20px; }
        h1 { font-size: 3em; margin: 0.2em 0; }
        p { font-size: 1.5em; margin-top: 10px; }
        nav ul { list-style-type: none; padding: 0; margin: 20px 0; display: flex; flex-wrap: wrap; justify-content: center; }
        nav ul li { margin: 10px 15px; }
        nav ul li a { color: white; text-decoration: none; font-weight: bold; padding: 5px 10px; border-radius: 4px; }
        nav ul li a:hover { text-decoration: underline; }
        
        /* STYLE DU BOUTON DE SUIVI SEUL ET CENTR√â */
        .suivi-button-container {
            text-align: center;
            margin: 30px auto; 
            max-width: 600px; 
        }
        .suivi-button {
            display: inline-block;
            background-color: #8B0000; 
            color: white !important;
            padding: 12px 25px;
            border-radius: 6px;
            text-decoration: none !important;
            font-weight: bold;
            font-size: 1.1em;
            letter-spacing: 1px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: none;
            cursor: pointer;
        }
        .suivi-button:hover {
            background-color: #A52A2A !important; 
            transform: translateY(-2px);
        }
        /* FIN DU STYLE DU BOUTON DE SUIVI */

        .page-image { width: 80%; max-width: 600px; margin: 20px auto 40px auto; display: block; border-radius: 8px; }
        .form-container { max-width: 700px; margin: 40px auto; background: #111; padding: 20px 30px; border-radius: 10px; text-align: left; }
        .form-container h2 { text-align: center; color: #fff; margin-bottom: 25px; }
        .info-box { background: #222; border-left: 4px solid #007bff; padding: 10px; margin-bottom: 15px; border-radius: 6px; color: #fff; font-size: 1em; text-align: center; }
        .disclaimer-message { background-color: #202010; border-left: 5px solid #ffcc00; padding: 15px; margin-bottom: 30px; border-radius: 6px; color: #ccc; font-size: 1em; line-height: 1.5; }
        .disclaimer-message strong { color: white; }
        .form-container label { display: block; margin-top: 15px; font-weight: bold; }
        .form-container input, .form-container textarea, .form-container select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #555; background: #222; color: #fff; box-sizing: border-box; transition: border 0.3s ease; }
        .form-container .input-error { border: 1px solid #ff6666 !important; }
        .date-input-group { display: flex; align-items: center; gap: 15px; }
        .date-input-group input[type="date"] { flex-grow: 1; width: auto; }
        .age-display { font-weight: normal; font-size: 0.9em; color: #aaa; white-space: nowrap; }
        .form-container button[type="submit"] { margin-top: 25px; padding: 12px 18px; border: none; border-radius: 66px; background: #007bff; color: white; cursor: pointer; width: 100%; font-weight: bold; letter-spacing: 1px; transition: background 0.3s; }
        .form-container button[type="submit"]:hover { background: #0056b3; }
        .status-message { margin-top: 12px; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
        .success { background: #3c5244; border: 1px solid #7ad6a7; color: #d4edda; }
        .error { background: #5c3434; border: 1px solid #f1a0a0; color: #f8d7da; }
        .sending { background: #2a3e5c; border: 1px solid #5c7fbf; color: #c9e6ff; }
        .support-section { text-align: center; margin-top: 40px; padding: 15px; background-color: #151515; border-top: 1px solid #333; color: #aaa; font-size: 0.85em; border-radius: 0 0 10px 10px; margin: 40px -30px -30px -30px; }
        .support-text { margin-bottom: 12px; line-height: 1.4; }
        .asterisk { vertical-align: super; font-size: 0.7em; margin-right: 2px; }
        .highlight { font-weight: bold; color: white; }
        .paypal-button { display: inline-block; padding: 8px 18px; background-color: #0070ba; color: white; text-decoration: none; border-radius: 20px; font-weight: bold; font-size: 0.9em; transition: background-color 0.3s ease, transform 0.2s ease; box-shadow: 0 0 5px rgba(0,0,0,0.5); border: none; cursor: pointer; }
        .paypal-button:hover { background-color: #005ea6; transform: translateY(-1px); }
        @media (max-width: 768px) { .form-container { margin: 20px; padding: 20px; } h1 { font-size: 2.5em; } p { font-size: 1.2em; } }
        @media (max-width: 480px) { h1 { font-size: 2em; } p { font-size: 1em; } nav ul li { margin: 10px 5px; } .date-input-group { flex-direction: column; gap: 5px; } .age-display { margin-top: 5px; } }
    </style>
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PMTZHZKR"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<header>
    <h1>La Flamme de l'Ombre</h1>
    <p>Cartomancien, cr√©ateur</p>
</header>

<nav>
    <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="about.html">√Ä propos</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="avis.html">Avis</a></li>
        <li><a href="carte.html">Carte du jour</a></li>
    </ul>
</nav>

<img src="images/Tirage.webp" alt="Tirage de Cartes" class="page-image">

<div class="suivi-button-container">
    <a href="Suivi.html" class="suivi-button">
        V√©rifier le Statut de ma Demande
    </a>
</div>
<div class="form-container">
    <h2>Pose ta question (Gratuite)</h2>
    
    <div class="disclaimer-message">
        **‚ú® Conseil de lecture :** Ces consultations vous sont offertes. Cependant, il est essentiel de se rappeler que la **pr√©cision des cartes** et la **clart√© du message** peuvent s'estomper si l'on en abuse. Pour que chaque lecture garde tout son sens et sa puissance, nous vous encourageons √† l'utiliser avec intention et non par habitude.
    </div>
    
    <div class="info-box">
        Remplissez les champs concernant une personne tierce <strong>seulement si votre question concerne une autre personne</strong>.
    </div>
    
    <form id="questionForm" method="POST">
        
        <label for="nom">Nom *</label>
        <input type="text" id="nom" name="Nom" required aria-required="true">

        <label for="prenom">Pr√©nom *</label>
        <input type="text" id="prenom" name="Pr√©nom" required aria-required="true">

        <label for="date_naissance">Date de naissance *</label>
        <div class="date-input-group">
            <input type="date" id="date_naissance" name="Date_Naissance" required aria-required="true" onchange="calculateAge('date_naissance', 'age_display', 'age_client')">
            <span id="age_display" class="age-display">√Çge : --</span>
        </div>
        <input type="hidden" id="age_client" name="Age"> 
        
        <label for="email">Adresse email *</label>
        <input type="email" id="email" name="Email" placeholder="exemple@domaine.com" required aria-required="true">

        <label for="nom_tiers">Nom personne tierce</label>
        <input type="text" id="nom_tiers" name="Nom_Partenaire" placeholder="Uniquement si question concerne une autre personne">

        <label for="prenom_tiers">Pr√©nom personne tierce</label>
        <input type="text" id="prenom_tiers" name="Pr√©nom_Partenaire" placeholder="Uniquement si question concerne une autre personne">

        <label for="date_naissance_tiers">Date de naissance personne tierce</label>
        <div class="date-input-group">
            <input type="date" id="date_naissance_tiers" name="Date_Naissance_Partenaire" onchange="calculateAge('date_naissance_tiers', 'age_display_tiers', 'age_tiers')">
            <span id="age_display_tiers" class="age-display">√Çge : --</span>
        </div>
        <input type="hidden" id="age_tiers" name="Age_Partenaire">


        <label for="question">Question pr√©cise *</label>
        <textarea id="question" name="Question" required aria-required="true"></textarea>

        <label for="temporalite">Temporalit√© *</label>
        <select id="temporalite" name="Temporalit√©" required aria-required="true">
            <option value="">-- Choisissez --</option>
            <option value="3 mois">Dans les 3 mois</option>
            <option value="1 an">Dans l'ann√©e</option>
            <option value="ann√©e en cours">Dans l‚Äôann√©e en cours</option>
            <option value="2 ans">Dans les 2 ans</option>
            <option value="3 ans">Dans les 3 ans</option>
            <option value="non concern√©">Non concern√© par la temporalit√©</option>
        </select>

        <button type="submit">Envoyer la question</button>
    </form>
    <div id="status"></div>

    <div class="support-section">
        <p class="support-text">
            <span class="asterisk">*</span> Ce service vous est utile ? Si vous le souhaitez et le pouvez, vous pouvez me soutenir par un petit <span class="highlight">Tips</span> (montant libre, aucun minimum requis) via le bouton ci-dessous. Merci infiniment !
        </p>
        <a href="https://www.paypal.com/ncp/payment/LQX3W8VBMFQTQ" target="_blank" class="paypal-button">
            Faire un Tips
        </a>
    </div>
    
</div>

<script>
    // **********************************************************************************************
    // üõë ATTENTION : CETTE URL DOIT CORRESPONDRE √Ä VOTRE NOUVEAU D√âPLOIEMENT FINAL üõë
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbycavO77Vu7c4XFS4Lj9VCiGdLm_J0mYYSs2_FEmi-Inz35dYaty17rCtJyrJ33KXfHdQ/exec'; 

    const form = document.getElementById('questionForm');
    const statusDiv = document.getElementById('status');
    const SUCCESS_MESSAGE_BASE = '‚úÖ Votre demande a √©t√© envoy√©e. Votre ID de suivi est : <strong>';

    /**
     * Calcule et affiche l'√¢ge √† partir d'une date de naissance.
     */
    function calculateAge(dateInputId, ageDisplayId, ageHiddenId) {
        const dateInput = document.getElementById(dateInputId);
        const ageDisplay = document.getElementById(ageDisplayId);
        const ageHidden = document.getElementById(ageHiddenId);
        
        const birthDateValue = dateInput.value;
        if (!birthDateValue) {
            ageDisplay.textContent = '√Çge : --';
            ageHidden.value = '';
            return;
        }

        const today = new Date();
        const birthDate = new Date(birthDateValue);
        let age = today.getFullYear() - birthDate.getFullYear();
        const m = today.getMonth() - birthDate.getMonth();

        if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        if (age < 0) {
            age = 0;
        }

        ageDisplay.textContent = `√Çge : ${age} ans`;
        ageHidden.value = age; 
    }

    /**
     * Valide les champs requis du formulaire.
     */
    function validateForm() {
        let isValid = true;
        const requiredFields = form.querySelectorAll('[required]');
        
        requiredFields.forEach(field => field.classList.remove('input-error'));
        statusDiv.innerHTML = '';

        let firstErrorField = null;

        requiredFields.forEach(field => {
            const isDateValid = field.type === 'date' ? field.value && !isNaN(new Date(field.value)) : true;

            if (!field.value.trim() || !isDateValid) {
                field.classList.add('input-error');
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = field;
                }
            }
        });

        if (!isValid) {
            statusDiv.innerHTML = '<div class="status-message error">‚ùå V√©rifiez les champs obligatoires (marqu√©s en rouge).</div>';
            if (firstErrorField) {
                firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                firstErrorField.focus();
            }
        }
        return isValid;
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Initialisation de l'√¢ge au chargement si une date par d√©faut existe
        calculateAge('date_naissance', 'age_display', 'age_client');
        calculateAge('date_naissance_tiers', 'age_display_tiers', 'age_tiers');
    });

    // Gestion de la soumission du formulaire
    form.addEventListener('submit', function(event) {
        event.preventDefault(); 
        if (!validateForm()) return; 
        
        const submitButton = form.querySelector('button[type="submit"]');
        submitButton.disabled = true;
        
        statusDiv.innerHTML = '<div class="status-message sending">‚öôÔ∏è Envoi de votre question en cours...</div>';
        
        // La m√©thode FormData encode les donn√©es pour le POST vers Apps Script
        const formData = new FormData(form);

        fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: formData,
        })
        .then(response => {
            if (!response.ok) throw new Error('Erreur de r√©seau ou de configuration du script. Code: ' + response.status);
            return response.json(); 
        })
        .then(data => {
            if (data.result === 'success' && data.id) {
                // Le script Apps Script doit retourner l'ID pour cette √©tape
                const finalMessage = SUCCESS_MESSAGE_BASE + data.id + '</strong>. La Flamme de l\'Ombre vous recontactera par email dans les plus brefs d√©lais.';
                statusDiv.innerHTML = `<div class="status-message success">${finalMessage}</div>`;

                // R√©initialisation du formulaire apr√®s succ√®s
                form.reset();
                document.getElementById('age_display').textContent = '√Çge : --';
                document.getElementById('age_display_tiers').textContent = '√Çge : --';
                document.getElementById('age_client').value = '';
                document.getElementById('age_tiers').value = '';

            } else {
                const errorMessage = data.message || "Une erreur inconnue est survenue c√¥t√© serveur Google.";
                statusDiv.innerHTML = `<div class="status-message error">‚ùå Erreur : ${errorMessage}</div>`;
            }
        })
        .catch(error => {
            console.error('Network/Parsing Error:', error);
            statusDiv.innerHTML = '<div class="status-message error">‚ùå Une erreur de connexion est survenue. Veuillez v√©rifier votre r√©seau.</div>';
        })
        .finally(() => {
            submitButton.disabled = false;
        });
    });
</script>

</body>
</html>
